# FontsReviewer 🚰💧

**Rate and review Barcelona's 1,745 public fountains**

An Android app built with Jetpack Compose that helps locals and tourists discover, rate, and review public drinking fountains across Barcelona. Browse anonymously or create an account to contribute reviews and climb the leaderboard!

---

## ✨ Features

- 🗺️ **Interactive Map** - View all 1,745 Barcelona fountains on an interactive Mapbox map
- 👁️ **Anonymous Browsing** - Explore reviews without creating an account
- ⭐ **4-Category Rating System** - Rate fountains by Taste, Freshness, Location, and Aesthetics
- 📊 **Personal Statistics** - Track your contributions and see your best-rated fountain highlighted
- 🏆 **Global Leaderboard** - Compete with other users for most reviews
- 🌍 **Multi-language** - Full support for English, Spanish, and Catalan
- 📱 **Offline-First** - All fountain locations cached locally for instant access

---

## 🛠️ Tech Stack

### Frontend
- **Language:** Kotlin
- **UI:** Jetpack Compose + Material 3
- **Architecture:** MVVM + Clean Architecture
- **DI:** Hilt (Dagger)
- **Navigation:** Navigation Compose
- **Local DB:** Room
- **Maps:** Mapbox Android SDK

### Backend
- **Database:** Supabase (PostgreSQL)
- **Authentication:** Supabase Auth
- **API:** Auto-generated REST API with Row Level Security

### Key Libraries
- Kotlin Coroutines & Flow
- Ktor Client (Supabase SDK)
- kotlinx.serialization
- Coil (image loading)
- DataStore (preferences)

---

## 📱 Screenshots

<!-- TODO: Add screenshots when available -->
```
[Map View]    [Fountain Details]    [Review Form]    [Leaderboard]
```

---

## 🚀 Getting Started

### Prerequisites

- Android Studio Hedgehog (2023.1.1) or newer
- JDK 11 or higher
- Android SDK 29+ (Android 10+)
- Supabase account ([sign up free](https://supabase.com))
- Mapbox account ([sign up free](https://mapbox.com))

### Setup Instructions

#### 1. Clone the Repository

```bash
git clone https://github.com/watxaut/FontsReviewer.git
cd FontsReviewer
```

#### 2. Configure Supabase

1. Create a new project at [supabase.com](https://supabase.com)
2. Execute the SQL schema from `implementation/SUPABASE_IMPLEMENTATION_GUIDE.md`
3. Get your project URL and anon key from Settings → API

#### 3. Configure Mapbox

1. Sign up at [mapbox.com](https://mapbox.com)
2. Create two tokens:
   - **Public token** (`pk.*`) - for displaying maps
   - **Secret token** (`sk.*`) - with `downloads:read` scope for SDK downloads

See `MAPBOX_SETUP_INSTRUCTIONS.md` for detailed steps.

#### 4. Create `local.properties`

Create a `local.properties` file in the project root:

```properties
# Android SDK path (auto-generated by Android Studio)
sdk.dir=/path/to/Android/sdk

# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key-here

# Mapbox Configuration
MAPBOX_PUBLIC_TOKEN=pk.your-public-token-here
MAPBOX_DOWNLOADS_TOKEN=sk.your-secret-token-here
```

**⚠️ NEVER commit this file! It's already in `.gitignore`**

#### 5. Sync and Build

1. Open the project in Android Studio
2. File → Sync Project with Gradle Files
3. Build → Rebuild Project
4. Run on device or emulator

---

## 📖 Documentation

- **[agents.md](AGENTS.md)** - Comprehensive guide for AI assistants and developers
- **[implementation/IMPLEMENTATION_PLANS.md](implementation/IMPLEMENTATION_PLANS.md)** - Architecture details and design decisions
- **[implementation/IMPLEMENTATION_STATUS.md](implementation/IMPLEMENTATION_STATUS.md)** - Current progress and known issues
- **[implementation/SUPABASE_IMPLEMENTATION_GUIDE.md](implementation/SUPABASE_IMPLEMENTATION_GUIDE.md)** - Backend setup guide
- **[MAPBOX_SETUP_INSTRUCTIONS.md](MAPBOX_SETUP_INSTRUCTIONS.md)** - Map integration guide

---

## 🏗️ Architecture

```
┌─────────────────────────────────────────────┐
│         Presentation Layer                   │
│  (Jetpack Compose + ViewModels + StateFlow) │
└─────────────────┬───────────────────────────┘
                  │
┌─────────────────▼───────────────────────────┐
│           Domain Layer                       │
│   (Business Logic + Use Cases + Interfaces) │
└─────────────────┬───────────────────────────┘
                  │
┌─────────────────▼───────────────────────────┐
│            Data Layer                        │
│  (Repositories + Room DB + Supabase API)    │
└─────────────────────────────────────────────┘
```

### Project Structure

```
app/src/main/java/com/watxaut/fontsreviewer/
├── data/           # Data sources and repositories
├── domain/         # Business logic and use cases
├── presentation/   # UI screens and ViewModels
├── di/             # Dependency injection modules
├── ui/             # Theme and common UI components
└── util/           # Utilities and helpers
```

---

## 🗄️ Database Schema

### Local (Room)
- **fountains** - 1,745 Barcelona fountain locations (offline cache)

### Remote (Supabase PostgreSQL)
- **profiles** - User accounts and statistics
- **reviews** - Fountain reviews with 4 rating categories
- **leaderboard** (VIEW) - User rankings
- **fountain_stats** (VIEW) - Aggregated metrics per fountain

---

## 🌍 Internationalization

The app is fully localized in:
- 🇬🇧 **English** (default)
- 🇪🇸 **Spanish** (Español)
- 🇨🇦 **Catalan** (Català)

All UI strings, validation messages, and error messages are translated.

---

## 🧪 Testing

```bash
# Run unit tests
./gradlew test

# Run instrumented tests
./gradlew connectedAndroidTest

# Run specific test
./gradlew test --tests "com.watxaut.fontsreviewer.domain.usecase.*"
```

---

## 🔐 Security

- ✅ All credentials stored in `local.properties` (gitignored)
- ✅ Supabase Row Level Security (RLS) policies enabled
- ✅ API keys loaded via `BuildConfig` (not hardcoded)
- ✅ Authentication via Supabase Auth (JWT tokens)
- ✅ HTTPS-only communication

**Never commit:**
- `local.properties`
- `app/src/main/res/values/supabase_config.xml`
- `logs/`
- Any API keys or tokens

---

## 🤝 Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Read `agents.md` for architecture guidelines
4. Follow the existing code style and conventions
5. Add tests for new functionality
6. Ensure all tests pass (`./gradlew test`)
7. Add strings in all 3 languages (EN, ES, CA)
8. Commit your changes (`git commit -m 'Add amazing feature'`)
9. Push to the branch (`git push origin feature/amazing-feature`)
10. Open a Pull Request

---

## 📝 License

[Add license information]

---

## 🙏 Acknowledgments

- Fountain data sourced from [Barcelona Open Data](https://opendata-ajuntament.barcelona.cat/)
- Map tiles by [Mapbox](https://mapbox.com)
- Backend powered by [Supabase](https://supabase.com)

---

## 📧 Contact

**Maintainer:** [watxaut](https://github.com/watxaut)

**Project Link:** [https://github.com/watxaut/FontsReviewer](https://github.com/watxaut/FontsReviewer)

---

## 🗓️ Project Status

**Current Status:** ✅ MVP Complete - Ready for Testing & Polish

**Last Updated:** 2025-10-11

### Completed ✅
- [x] Backend setup (Supabase)
- [x] Data layer (Room + Supabase integration)
- [x] All UI screens
- [x] Authentication flow
- [x] Review system
- [x] Leaderboard
- [x] Multi-language support

### In Progress 🚧
- [ ] Unit tests
- [ ] UI tests
- [ ] Performance optimization
- [ ] Offline mode improvements

### Planned 📋
- [ ] Dark mode support
- [ ] Push notifications
- [ ] Photo uploads for fountains
- [ ] Route planning (multi-fountain visits)
- [ ] Water quality reports

---

**Made with ❤️ in Barcelona**
